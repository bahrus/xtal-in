import{AddEventListener}from"./add-event-listener.js";var passTo="pass-to",XtalBinder=function(_AddEventListener){babelHelpers.inherits(XtalBinder,_AddEventListener);function XtalBinder(){babelHelpers.classCallCheck(this,XtalBinder);return babelHelpers.possibleConstructorReturn(this,(XtalBinder.__proto__||Object.getPrototypeOf(XtalBinder)).apply(this,arguments))}babelHelpers.createClass(XtalBinder,[{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldValue,newValue){babelHelpers.get(XtalBinder.prototype.__proto__||Object.getPrototypeOf(XtalBinder.prototype),"attributeChangedCallback",this).call(this,name,oldValue,newValue);switch(name){case passTo:this._passTo=newValue;this.parsePassTo();break;}}},{key:"connectedCallback",value:function connectedCallback(){var _this=this;babelHelpers.get(XtalBinder.prototype.__proto__||Object.getPrototypeOf(XtalBinder.prototype),"connectedCallback",this).call(this);this._upgradeProperties(["passTo"]);this._observer=new MutationObserver(function(mutationsList){mutationsList.forEach(function(mutation){mutation.addedNodes.forEach(function(node){_this.cascade(_this._lastEvent,node)})})});this._observer.observe(this.parentElement,{childList:!0,subtree:!0})}},{key:"disconnectedCallback",value:function disconnectedCallback(){babelHelpers.get(XtalBinder.prototype.__proto__||Object.getPrototypeOf(XtalBinder.prototype),"disconnectedCallback",this).call(this);if(this._observer)this._observer.disconnect()}},{key:"parsePassTo",value:function parsePassTo(){var _this2=this;this.cssKeyMappers=[];var endsWithBrace=this._passTo.endsWith("}"),adjustedPassTo=this._passTo+(endsWithBrace?";":""),splitPassTo=adjustedPassTo.split("};");splitPassTo.forEach(function(passTo){var splitPassTo2=passTo.split("{"),tokens=splitPassTo2[1].split(";"),propMapper={};tokens.forEach(function(token){var nameValuePair=token.split(":");propMapper[nameValuePair[0]]=nameValuePair[1].split(".")});_this2.cssKeyMappers.push({cssSelector:splitPassTo2[0],propMapper:propMapper})})}},{key:"setResult",value:function setResult(val,e){babelHelpers.get(XtalBinder.prototype.__proto__||Object.getPrototypeOf(XtalBinder.prototype),"setResult",this).call(this,val,e);this._lastEvent=e;this.cascade(e,this.parentElement)}},{key:"cascade",value:function cascade(e,refElement){var _this3=this;if(!this.cssKeyMappers)return;this.cssKeyMappers.forEach(function(cssKeyMapper){_this3.qsa(cssKeyMapper.cssSelector,refElement).forEach(function(target){var _loop=function(){var pathSelector=cssKeyMapper.propMapper[key],context=e;pathSelector.forEach(function(path){if(context)context=context[path]});target[key]=context};for(var key in cssKeyMapper.propMapper){_loop()}})})}},{key:"passTo",get:function get(){return this._passTo||this.getAttribute(passTo)},set:function set(val){this.setAttribute(passTo,val)}}],[{key:"is",get:function get(){return"xtal-binder"}},{key:"observedAttributes",get:function get(){return babelHelpers.get(XtalBinder.__proto__||Object.getPrototypeOf(XtalBinder),"observedAttributes",this).concat([passTo])}}]);return XtalBinder}(AddEventListener);if(!customElements.get(XtalBinder.is)){customElements.define(XtalBinder.is,XtalBinder)}