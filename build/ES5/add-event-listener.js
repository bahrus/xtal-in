import{XtalCustomEvent,registerTagName}from"./custom-event.js";var stopPropagation="stop-propagation",on="on",ifMatches="if-matches",valueProps="value-props",disabledAttributeMatcher="disabled-attribute-matcher",defaultTagName_addEventListener="add-event-listener",canonicalTagName_XtalInCurry="xtal-in-curry";export function getParent(el){var parent=el.parentNode;if(11===parent.nodeType){return parent.host}return parent}export var AddEventListener=function(_XtalCustomEvent){babelHelpers.inherits(AddEventListener,_XtalCustomEvent);function AddEventListener(){var _this;babelHelpers.classCallCheck(this,AddEventListener);_this=babelHelpers.possibleConstructorReturn(this,(AddEventListener.__proto__||Object.getPrototypeOf(AddEventListener)).call(this));_this._isSubClass=!0;return _this}babelHelpers.createClass(AddEventListener,[{key:"set",value:function set(val){if(val){this.setAttribute(disabledAttributeMatcher,"")}else{this.removeAttribute(disabledAttributeMatcher)}}},{key:"qsa",value:function qsa(css,from){return[].slice.call((from?from:this).querySelectorAll(css))}},{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldValue,newValue){var _this2=this;switch(name){case stopPropagation:this._stopPropagation=null!==newValue;break;case valueProps:this._valueProps=newValue;case ifMatches:this._ifMatches=newValue;break;case disabledAttributeMatcher:this._disabledAttributeMatcher=null!==newValue;case on:this._on=newValue;var parent=getParent(this),bundledAllHandlers=parent[canonicalTagName_XtalInCurry];if(this._on){if(!this._boundEventHandler){this._boundEventHandler=this.handleEvent.bind(parent)}if(!bundledAllHandlers){bundledAllHandlers=parent[canonicalTagName_XtalInCurry]={}}var bundledHandlersForSingleEventType=bundledAllHandlers[this._on];if(!bundledHandlersForSingleEventType){bundledHandlersForSingleEventType=bundledAllHandlers[this._on]=[];parent.addEventListener(this._on,this._boundEventHandler)}bundledHandlersForSingleEventType.push(this);this.enableElements();if("loading"===document.readyState){document.addEventListener("DOMContentLoaded",function(){_this2.enableElements()})}}else{this.disconnect()}break;}babelHelpers.get(AddEventListener.prototype.__proto__||Object.getPrototypeOf(AddEventListener.prototype),"attributeChangedCallback",this).call(this,name,oldValue,newValue)}},{key:"enableElements",value:function enableElements(){if(this.disabledAttributeMatcher){this.setAttribute("attached","");var parent=getParent(this);if(0<this.qsa(":not(attached)[".concat(this.disabledAttributeMatcher,"]"),parent).length)return;this.qsa("[disabled=\"".concat(this.disabledAttributeMatcher,"\"]"),parent).forEach(function(el){el.removeAttribute("disabled")})}}},{key:"modifyEvent",value:function modifyEvent(e,subscriber){if(subscriber.stopPropagation)e.stopPropagation()}},{key:"handleEvent",value:function handleEvent(e){var _this3=this,bundledHandlers=this["xtal-in-curry"][e.type];bundledHandlers.forEach(function(subscriber){var target=e.target;if(subscriber.ifMatches){if(!target.matches(subscriber.ifMatches))return}subscriber.modifyEvent(e,subscriber);if(_this3.valueProps){var values,hasMultipleValues=!1;if(-1<_this3.valueProps.indexOf(",")){hasMultipleValues=!0;values={};var parsedValueProps=_this3.valueProps.split(",");parsedValueProps.forEach(function(prop){values[prop]=target[prop]})}else{values=target[_this3._valueProps]}var eventObj={};if(values){if(hasMultipleValues){eventObj.values=values}else{eventObj.value=values}eventObj.context=e.detail}else{Object.assign(eventObj,e.detail)}subscriber.detail=eventObj}else{var detail=e.detail;switch(babelHelpers.typeof(detail)){case"object":subscriber.detail=Object.assign({},detail);break;default:subscriber.detail=detail;}}var receipt;switch(babelHelpers.typeof(subscriber.detail)){case"object":receipt=Object.assign({},subscriber.detail);default:receipt=subscriber.detail;}subscriber.setResult(receipt,e)})}},{key:"removeElement",value:function removeElement(array,element){var index=array.indexOf(element);if(-1!==index){array.splice(index,1)}}},{key:"disconnect",value:function disconnect(){var parent=getParent(this),bundledAllHandlers=parent[canonicalTagName_XtalInCurry],bundledHandlersForSingleEventType=bundledAllHandlers[this._on];this.removeElement(bundledHandlersForSingleEventType,this);if(0===bundledHandlersForSingleEventType.length&&this._boundEventHandler){parent.removeEventListener(this._on,this._boundEventHandler)}}},{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(AddEventListener.prototype.__proto__||Object.getPrototypeOf(AddEventListener.prototype),"connectedCallback",this).call(this);this._upgradeProperties(["on","stopPropagation","valueProps"])}},{key:"disconnectedCallback",value:function disconnectedCallback(){this.disconnect()}},{key:"stopPropagation",get:function get(){return this._stopPropagation||this.hasAttribute(stopPropagation)},set:function set(val){if(val){this.setAttribute(stopPropagation,"")}else{this.removeAttribute(stopPropagation)}}},{key:"disabledAttributeMatcher",get:function get(){return this._disabledAttributeMatcher||this.getAttribute(disabledAttributeMatcher)}},{key:"on",get:function get(){return this._on},set:function set(val){this.setAttribute(on,val)}},{key:"ifMatches",get:function get(){return this._ifMatches||this.getAttribute(ifMatches)},set:function set(val){this.setAttribute(ifMatches,val)}},{key:"valueProps",get:function get(){return this._valueProps||this.getAttribute(valueProps)},set:function set(val){this.setAttribute(valueProps,val.toString())}}],[{key:"observedAttributes",get:function get(){return babelHelpers.get(AddEventListener.__proto__||Object.getPrototypeOf(AddEventListener),"observedAttributes",this).concat([stopPropagation,on,ifMatches,valueProps,disabledAttributeMatcher])}}]);return AddEventListener}(XtalCustomEvent);if(!customElements.get(canonicalTagName_XtalInCurry)){registerTagName(defaultTagName_addEventListener,AddEventListener);var XtalInCurry=function(_AddEventListener){babelHelpers.inherits(XtalInCurry,_AddEventListener);function XtalInCurry(){babelHelpers.classCallCheck(this,XtalInCurry);return babelHelpers.possibleConstructorReturn(this,(XtalInCurry.__proto__||Object.getPrototypeOf(XtalInCurry)).apply(this,arguments))}return XtalInCurry}(AddEventListener);customElements.define(canonicalTagName_XtalInCurry,XtalInCurry)}