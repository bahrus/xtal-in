import{XtalCustomEvent,registerTagName}from'./custom-event.js';const stopPropagation='stop-propagation',on='on',ifMatches='if-matches',valueProps='value-props',cascadeDown='cascade-down',defaultTagName_addEventListener='add-event-listener',canonicalTagName_XtalInCurry='xtal-in-curry';export class AddEventListener extends XtalCustomEvent{constructor(){super(),this._isSubClass=!0}get stopPropagation(){return this._stopPropagation}set stopPropagation(a){a?this.setAttribute(stopPropagation,''):this.removeAttribute(stopPropagation)}get on(){return this._on}set on(a){this.setAttribute(on,a)}get ifMatches(){return this._ifMatches}set ifMatches(a){this.setAttribute(ifMatches,a)}get valueProps(){return this._valueProps}set valueProps(a){this.setAttribute(valueProps,a.toString())}get cascadeDown(){return this.getAttribute(cascadeDown)}set cascadeDown(a){this.setAttribute(cascadeDown,a)}static get observedAttributes(){return super.observedAttributes.concat([stopPropagation,on,ifMatches,valueProps,cascadeDown])}attributeChangedCallback(a,b,c){switch(super.attributeChangedCallback(a,b,c),a){case stopPropagation:this._stopPropagation=null!==c;break;case valueProps:this._valueProps=null===c?null:c.startsWith('[')?JSON.parse(c):c;case ifMatches:this._ifMatches=c;break;case cascadeDown:this.propagateDown();break;case on:this._on=c;const d=this.parentElement;let e=d[canonicalTagName_XtalInCurry];if(this._on){e||(e=d[canonicalTagName_XtalInCurry]={});let a=e[this._on];a||(a=e[this._on]=[],this.parentElement.addEventListener(this._on,this.handleEvent)),a.push(this)}else this.disconnect();}}modifyEvent(a,b){b.stopPropagation&&a.stopPropagation()}propagateDown(){if(this.eventName){const a=this.eventName+'-props',b=this.parentElement.querySelectorAll('['+a+']');for(let c=0,d=b.length;c<d;c++){const d=b[c],e=d.getAttribute(a).split(',');e.forEach((a)=>{d[a]=this.value})}}}handleEvent(a){const b=this['xtal-in-curry'][a.type];b.forEach((b)=>{const c=a.target;if(!b._ifMatches||c.matches(b._ifMatches)){if(b.modifyEvent(a,b),this._valueProps){let a,d=!1;Array.isArray(this._valueProps)?(d=!0,a={},this._valueProps.forEach((b)=>{a[b]=c[b]})):a=c[this._valueProps];const e={};b._zoomedDetail&&(e.context=b._zoomedDetail),a&&(d?e.values=a:e.value=a),b.detail=e}else b.detail=b._zoomedDetail;const d=Object.assign({},b.detail);b.setValue(d),b.cascadeDown&&b.propagateDown()}})}removeElement(a,b){const c=a.indexOf(b);-1!==c&&a.splice(c,1)}disconnect(){const a=this.parentElement;let b=a[canonicalTagName_XtalInCurry];const c=b[this._on];this.removeElement(c,this),0===c.length&&this.parentElement.removeEventListener(this._on,this.handleEvent)}connectedCallback(){super.connectedCallback(),this._upgradeProperties(['on','stopPropagation','valueProps'])}disconnectedCallback(){this.disconnect()}}if(!customElements.get(canonicalTagName_XtalInCurry)){registerTagName(defaultTagName_addEventListener,AddEventListener);customElements.define(canonicalTagName_XtalInCurry,class extends AddEventListener{})}