import{XtalCustomEvent,registerTagName}from"./custom-event.js";const stopPropagation="stop-propagation",on="on",ifMatches="if-matches",valueProps="value-props",disabledAttributeMatcher="disabled-attribute-matcher",defaultTagName_addEventListener="add-event-listener",canonicalTagName_XtalInCurry="xtal-in-curry";export class AddEventListener extends XtalCustomEvent{constructor(){super(),this._isSubClass=!0}get stopPropagation(){return this._stopPropagation||this.hasAttribute("stop-propagation")}set stopPropagation(a){a?this.setAttribute("stop-propagation",""):this.removeAttribute("stop-propagation")}get disabledAttributeMatcher(){return this._disabledAttributeMatcher||this.getAttribute(disabledAttributeMatcher)}set(a){a?this.setAttribute(disabledAttributeMatcher,""):this.removeAttribute(disabledAttributeMatcher)}get on(){return this._on}set on(a){this.setAttribute(on,a)}get ifMatches(){return this._ifMatches||this.getAttribute(ifMatches)}set ifMatches(a){this.setAttribute(ifMatches,a)}get valueProps(){return this._valueProps||this.getAttribute(valueProps)}set valueProps(a){this.setAttribute(valueProps,a.toString())}static get observedAttributes(){return super.observedAttributes.concat(["stop-propagation",on,ifMatches,valueProps,disabledAttributeMatcher])}qsa(a,b){return[].slice.call((b?b:this).querySelectorAll(a))}attributeChangedCallback(a,b,c){switch(a){case"stop-propagation":this._stopPropagation=null!==c;break;case valueProps:this._valueProps=c;case ifMatches:this._ifMatches=c;break;case disabledAttributeMatcher:this._disabledAttributeMatcher=null!==c;case on:this._on=c;const b=this.parentElement;let d=b[canonicalTagName_XtalInCurry];if(this._on){d||(d=b[canonicalTagName_XtalInCurry]={});let a=d[this._on];a||(a=d[this._on]=[],this.parentElement.addEventListener(this._on,this.handleEvent)),a.push(this),this.enableElements(),"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",()=>{this.enableElements()})}else this.disconnect();}super.attributeChangedCallback(a,b,c)}enableElements(){if(this.disabledAttributeMatcher){if(this.setAttribute("attached",""),0<this.qsa(`:not(attached)[${this.disabledAttributeMatcher}]`,this.parentElement).length)return;this.qsa(`[disabled="${this.disabledAttributeMatcher}"]`,this.parentElement).forEach(a=>{a.removeAttribute("disabled")})}}modifyEvent(a,b){b.stopPropagation&&a.stopPropagation()}handleEvent(a){const b=this["xtal-in-curry"][a.type];b.forEach(b=>{const c=a.target;if(!b.ifMatches||c.matches(b.ifMatches)){if(b.modifyEvent(a,b),this.valueProps){let d,e=!1;if(-1<this.valueProps.indexOf(",")){e=!0,d={};const a=this.valueProps.split(",");a.forEach(a=>{d[a]=c[a]})}else d=c[this._valueProps];const f={};d?(e?f.values=d:f.value=d,f.context=a.detail):Object.assign(f,a.detail),b.detail=f}else b.detail=Object.assign({},a.detail);const d=Object.assign({},b.detail);b.setValue(d,a)}})}removeElement(a,b){const c=a.indexOf(b);-1!==c&&a.splice(c,1)}disconnect(){const a=this.parentElement;let b=a[canonicalTagName_XtalInCurry];const c=b[this._on];this.removeElement(c,this),0===c.length&&this.parentElement.removeEventListener(this._on,this.handleEvent)}connectedCallback(){super.connectedCallback(),this._upgradeProperties(["on","stopPropagation","valueProps"])}disconnectedCallback(){this.disconnect()}}if(!customElements.get(canonicalTagName_XtalInCurry)){registerTagName(defaultTagName_addEventListener,AddEventListener);customElements.define(canonicalTagName_XtalInCurry,class extends AddEventListener{})}